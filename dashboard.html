<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Discord Dashboard</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
    }
    header {
      background-color: #7289DA;
      color: #fff;
      padding: 15px;
      text-align: right;
    }
    .container {
      text-align: center;
      padding: 20px;
    }
    #userProfile {
      display: flex;
      flex-direction: column;
      align-items: center;
      margin-top: 20px;
    }
    #userImage {
      width: 100px;
      height: 100px;
      border-radius: 50%;
      margin-top: 10px;
    }
    #username {
      font-size: 1.5em;
      margin-top: 10px;
    }
    #discriminator {
      color: #999;
      margin-top: 5px;
    }
    #userBanner {
      width: 100%;
      height: 200px;
      margin-top: 20px;
      object-fit: cover;
    }
    #badges {
      display: flex;
      justify-content: center;
      margin-top: 10px;
    }
    .badge {
      margin: 0 5px;
    }
  </style>
</head>
<body>

<header>
  <div id="userInfo"></div>
</header>

<div class="container">
  <h1>Discord Dashboard</h1>
  <div id="userProfile" style="display:none;">
    <div id="userImage"></div>
    <div id="username"></div>
    <div id="discriminator"></div>
    <img id="userBanner" alt="User Banner">
    <div id="badges"></div>
  </div>
</div>

<script>
  // Function to parse query parameters from URL
  function getQueryParameter(name) {
    const urlParams = new URLSearchParams(window.location.search);
    return urlParams.get(name);
  }

  // Function to fetch user information from Discord API
  async function fetchUserInfo(accessToken) {
    try {
      const response = await fetch('https://discord.com/api/users/@me', {
        headers: {
          Authorization: `Bearer ${accessToken}`,
        },
      });
      const user = await response.json();
      return user;
    } catch (error) {
      console.error('Error fetching user information:', error);
      return null;
    }
  }

  // Function to display user information on the page
  function displayUserInfo(user) {
    document.getElementById('userInfo').innerHTML = `Logged in as: ${user.username}#${user.discriminator}`;
    document.getElementById('userImage').style.backgroundImage = `url('https://cdn.discordapp.com/avatars/${user.id}/${user.avatar}.png')`;
    document.getElementById('username').innerText = user.username;
    document.getElementById('discriminator').innerText = `#${user.discriminator}`;
    document.getElementById('userBanner').src = user.banner ? `https://cdn.discordapp.com/banners/${user.id}/${user.banner}.png` : '';
    displayBadges(user);
    document.getElementById('userProfile').style.display = 'flex';
  }

// Function to display user badges
function displayBadges(user) {
  const badgesContainer = document.getElementById('badges');

  if (user.public_flags) {
    const badges = Object.entries(user.public_flags)
      .filter(([key, value]) => value)
      .map(([key]) => key);

    badgesContainer.innerHTML = badges.map(badge => `<img src="https://discord.com/assets/${badge}.png" alt="${badge}" class="badge">`).join('');
  }
}


  // Check if the URL contains the 'code' parameter
  const authorizationCode = getQueryParameter('code');

  if (authorizationCode) {
    // Replace YOUR_CLIENT_ID, YOUR_CLIENT_SECRET, and REDIRECT_URI with your actual values
    const clientId = '1160292132934922343';
    const clientSecret = 'J0AO6X2EzNhFAQ1DsaDLckclvR_McOkr';
    const redirectUri = 'https://tommager1107.github.io/MajerGang/dashboard.html'; // Update this with your GitHub Pages URL

    // Exchange the authorization code for an access token
    fetch('https://discord.com/api/oauth2/token', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/x-www-form-urlencoded',
      },
      body: `client_id=${clientId}&client_secret=${clientSecret}&code=${authorizationCode}&grant_type=authorization_code&redirect_uri=${encodeURIComponent(redirectUri)}`,
    })
      .then(response => response.json())
      .then(data => {
        const accessToken = data.access_token;

        // Fetch user information using the access token
        fetchUserInfo(accessToken)
          .then(user => {
            if (user) {
              // Display user information on the page
              displayUserInfo(user);
            }
          });
      })
      .catch(error => {
        console.error('Error exchanging authorization code for access token:', error);
      });
  }
</script>

</body>
</html>
