<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Discord Dashboard</title>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background-color: #f0f0f0;
      margin: 0;
      padding: 0;
      transition: background-color 0.3s, color 0.3s;
    }

    header {
      background-color: #7289DA;
      color: #fff;
      padding: 15px;
      text-align: right;
    }

    .container {
      text-align: center;
      padding: 20px;
    }

    #userProfile {
      display: flex;
      flex-direction: column;
      align-items: center;
      margin-top: 20px;
      background-color: #fff;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
      transition: background-color 0.3s, box-shadow 0.3s;
    }

    #userImage {
      width: 100px;
      height: 100px;
      border-radius: 50%;
      margin-top: 10px;
      background-size: cover;
    }

    #username {
      font-size: 1.5em;
      margin-top: 10px;
      color: #333;
    }

    #discriminator {
      color: #999;
      margin-top: 5px;
    }

    #aboutMe {
      margin-top: 20px;
      color: #666;
    }

    #minecraftNickSection {
      margin-top: 20px;
      text-align: left;
    }

    label {
      font-size: 1em;
      color: #333;
    }

    input {
      width: 200px;
      padding: 5px;
      margin-top: 5px;
      border: 1px solid #ddd;
      border-radius: 3px;
    }

    #minecraftNickDisplay {
      font-size: 1em;
      color: #333; /* Set the default color */
      margin-top: 10px;
    }

    button {
      padding: 8px 12px;
      margin-top: 10px;
      background-color: #7289DA;
      color: #fff;
      border: none;
      border-radius: 3px;
      cursor: pointer;
      transition: background-color 0.3s;
    }

    button:hover {
      background-color: #4e5d94;
    }

    /* Dark Theme */
    body.dark-mode {
      background-color: #121212;
      color: #fff;
    }

    header.dark-mode {
      background-color: #333;
    }

    #userProfile.dark-mode {
      background-color: #333;
      box-shadow: 0 4px 8px rgba(255, 255, 255, 0.1);
    }

    #minecraftNickDisplay.dark-mode {
      color: #fff; /* Set the color for dark mode */
    }

    /* Slider Styles */
    .slider-container {
      display: flex;
      align-items: center;
      margin-top: 10px;
    }

    .slider-label {
      margin-right: 10px;
      color: #333;
    }

    .slider {
      -webkit-appearance: none;
      width: 50px;
      height: 25px;
      background: #ddd;
      outline: none;
      border-radius: 25px;
      transition: background 0.3s;
      position: relative;
      cursor: pointer;
      margin-left: 10px; /* Added margin for spacing */
    }

    .slider:checked {
      background: #7289DA;
    }

    .slider:before {
      content: '';
      position: absolute;
      top: 50%;
      left: 5px; /* Adjusted left position */
      transform: translate(-50%, -50%);
      width: 15px;
      height: 15px;
      background-color: #fff;
      border-radius: 50%;
      transition: transform 0.3s;
      display: block;
    }

    .slider:checked:before {
      left: 25px; /* Adjusted left position */
      transform: translate(-50%, -50%);
    }
  </style>
</head>
<body>

<header>
  <div id="userInfo"></div>
  <div class="slider-container">
    <span class="slider-label">Toggle Dark Mode:</span>
    <input type="checkbox" class="slider" id="darkModeToggle" onchange="toggleDarkMode()">
  </div>
</header>

<div class="container">
  <h1>Discord Dashboard</h1>
  <div id="userProfile" style="display:none;">
    <div id="userImage"></div>
    <div id="username"></div>
    <div id="discriminator"></div>
    <div id="aboutMe"></div>
    <div id="minecraftNickSection">
      <label for="minecraftNick"></label>
      <input type="text" id="minecraftNick" placeholder="Enter your Minecraft Nickname">
      <button onclick="saveMinecraftNick()">Save</button>
      <div id="minecraftNickDisplay"></div>
    </div>
  </div>
</div>

<script>
  // Function to parse query parameters from URL
  function getQueryParameter(name) {
    const urlParams = new URLSearchParams(window.location.search);
    return urlParams.get(name);
  }

  // Function to fetch user information from Discord API
  async function fetchUserInfo(accessToken) {
    try {
      const response = await fetch('https://discord.com/api/users/@me', {
        headers: {
          Authorization: `Bearer ${accessToken}`,
        },
      });
      const user = await response.json();
      console.log('User Object:', user);
      return user;
    } catch (error) {
      console.error('Error fetching user information:', error);
      return null;
    }
  }

  // Function to save Minecraft Nickname to localStorage
  function saveMinecraftNick() {
    const minecraftNick = document.getElementById('minecraftNick').value;
    const user = JSON.parse(localStorage.getItem('discordUser'));
    localStorage.setItem(`minecraftNick_${user.id}`, minecraftNick);
    alert('Minecraft Nickname saved successfully!');
    displayUserInfo();
  }

  // Function to toggle between light and dark themes
  function toggleDarkMode() {
    const darkModeToggle = document.getElementById('darkModeToggle');
    document.body.classList.toggle('dark-mode', darkModeToggle.checked);
    document.getElementById('userProfile').classList.toggle('dark-mode', darkModeToggle.checked);
    document.querySelector('header').classList.toggle('dark-mode', darkModeToggle.checked);
    document.getElementById('minecraftNickDisplay').classList.toggle('dark-mode', darkModeToggle.checked);
  }

  // Function to display user information on the page
  async function displayUserInfo() {
    // Check if the URL contains the 'code' parameter
    const authorizationCode = getQueryParameter('code');
    if (!authorizationCode) return;

    // Replace YOUR_CLIENT_ID, YOUR_CLIENT_SECRET, and REDIRECT_URI with your actual values
    const clientId = '1160292132934922343';
    const clientSecret = 'J0AO6X2EzNhFAQ1DsaDLckclvR_McOkr';
    const redirectUri = 'https://tommager1107.github.io/MajerGang/dashboard.html';

    // Exchange the authorization code for an access token
    const response = await fetch('https://discord.com/api/oauth2/token', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/x-www-form-urlencoded',
      },
      body: `client_id=${clientId}&client_secret=${clientSecret}&code=${authorizationCode}&grant_type=authorization_code&redirect_uri=${encodeURIComponent(redirectUri)}`,
    });

    const data = await response.json();
    const accessToken = data.access_token;

    // Fetch user information using the access token
    const user = await fetchUserInfo(accessToken);

    if (user) {
      // Store the user in localStorage for future reference
      localStorage.setItem('discordUser', JSON.stringify(user));

      // Display user information on the page
      document.getElementById('userInfo').innerHTML = `Logged in as: ${user.username}#${user.discriminator}`;
      document.getElementById('userImage').style.backgroundImage = `url('https://cdn.discordapp.com/avatars/${user.id}/${user.avatar}.png')`;
      document.getElementById('username').innerText = user.username;
      document.getElementById('discriminator').innerText = `#${user.discriminator}`;

      // Display "About Me" section
      document.getElementById('aboutMe').innerHTML = '<p>About Me:</p>' + (user.bio ? `<p>${user.bio}</p>` : '<p>No bio available</p>');

      // Display Minecraft Nickname section
      const minecraftNickDisplay = document.getElementById('minecraftNickDisplay');
      const storedMinecraftNick = localStorage.getItem(`minecraftNick_${user.id}`);

      if (storedMinecraftNick) {
        minecraftNickDisplay.innerHTML = `<p>Minecraft Nickname: ${storedMinecraftNick}</p>`;
      } else {
        minecraftNickDisplay.innerHTML = '<p>No Minecraft Nickname</p>';
      }
      
      // Show the user profile section
      document.getElementById('userProfile').style.display = 'flex';
    }
  }

  // Call the displayUserInfo function on page load
  displayUserInfo();
</script>

</body>
</html>
